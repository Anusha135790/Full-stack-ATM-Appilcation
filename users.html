{% extends 'admin/admin_base.html' %}

{% block title %}Admin Users{% endblock %}

{% block admin_content %}

<h2>Users Management</h2>

<div>
    <form method="get">
        <input type="text" name="name" value="{{ request.GET.name|default:'' }}" placeholder="Name">
        <input type="text" name="email" value="{{ request.GET.email|default:'' }}" placeholder="Email">
        <select name="role">
            <option value="">All Roles</option>
            <!-- Add your roles here or use loop -->
            <option value="admin" {% if request.GET.role == 'admin' %}selected{% endif %}>Admin</option>
            <option value="user" {% if request.GET.role == 'user' %}selected{% endif %}>User</option>
        </select>
        <button type="submit">Filter</button>
        <a href="{% url 'admin_users' %}">Reset</a>
    </form>
</div>

<p>Total Users: {{ total_users }}</p>

<h3>Users List</h3>

{% if users %}
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Profile</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Role</th>
                <th>Joined</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.USERID }}</td>
                <td>
                    {% if user.PROFILE_IMAGE %}
                        <img src="{{ user.PROFILE_IMAGE.url }}" width="50" alt="Profile">
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ user.NAME }}</td>
                <td>{{ user.EMAIL }}</td>
                <td>{{ user.PHONE_NUMBER|default:"â€”" }}</td>
                <td>{{ user.ROLE }}</td>
                <td>{{ user.ACCOUNT_CREATED|date:"d-M-Y" }}</td>
                <td>
                    <a href="{% url 'admin_user_detail' user.USERID %}">View</a>
                    {% if user.ROLE != 'admin' %}
                        | <a href="{% url 'admin_delete_user' user.USERID %}" onclick="return confirm('Delete this user?')">Delete</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No users found.</p>
{% endif %}

{% endblock %}